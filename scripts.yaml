cast_dashboard_keuken:
  sequence:
  - action: cast.show_lovelace_view
    metadata: {}
    data:
      entity_id: media_player.keuken
      view_path: '0'
      dashboard_path: dashboard-keuken
  alias: Cast dashboard-keuken
  description: ''
jeroen_gaat_slapen:
  sequence:
  - action: automation.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: automation.jeroen_gaat_slapen
  alias: Jeroen gaat slapen
  description: ''
  icon: mdi:chat-sleep
het_eten_is_klaar:
  sequence:
  - action: automation.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: automation.eten_klaar
  alias: Het eten is klaar
  description: ''
  icon: mdi:food
send_telegram_message:
  alias: Send Smart Telegram Message
  description: Routes messages to Test or Family chat based on labels. Debug info is hidden in Production.
  fields:
    message_text:
      description: The message content.
      required: true
      selector:
        text:
    caller_id:
      description: Entity ID of the caller (for label checking).
      required: true
      selector:
        entity:
  sequence:
  - variables:
      # Get labels for the calling entity
      labels_list: "{{ labels(caller_id) | default([], true) }}"
      is_test_mode: "{{ 'test' in labels_list }}"
      
      # Determine Target Chat
      target_chat: >
        {% if is_test_mode %}
          {{ states('input_text.telegram_chatid_test') }}
        {% else %}
          {{ states('input_text.telegram_chatid_family') }}
        {% endif %}

      # Construct Message: Only add debug info if in Test Mode
      final_message: >
        {{ message_text }}
        {% if is_test_mode %}
        
        --- ðŸ›  DEBUG INFO ---
        Caller: {{ caller_id }}
        Mode: TEST
        Labels: {{ labels_list | join(', ') }}
        {% endif %}

  - action: telegram_bot.send_message
    data:
      target: "{{ target_chat }}"
      message: "{{ final_message }}"
      # Optional: Add parse_mode if you use Markdown/HTML often
      parse_mode: markdown
