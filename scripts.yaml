cast_dashboard_keuken:
  sequence:
  - action: cast.show_lovelace_view
    metadata: {}
    data:
      entity_id: media_player.keuken
      view_path: '0'
      dashboard_path: dashboard-keuken
  alias: Cast dashboard-keuken
  description: ''
jeroen_gaat_slapen:
  sequence:
  - action: automation.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: automation.jeroen_gaat_slapen
  alias: Jeroen gaat slapen
  description: ''
  icon: mdi:chat-sleep
het_eten_is_klaar:
  sequence:
  - action: automation.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: automation.eten_klaar
  alias: Het eten is klaar
  description: ''
  icon: mdi:food
send_telegram_message:
  alias: Send Smart Telegram Message
  description: Routes messages to the correct Notify Entity based on labels.
  fields:
    message_text:
      description: The message content.
      required: true
      selector:
        text:
    caller_id:
      description: Entity ID of the caller (for label checking).
      required: true
      selector:
        entity:
  sequence:
    - variables:
        labels_list: "{{ labels(caller_id) | default([], true) }}"
        is_test_mode: "{{ 'test' in labels_list }}"
        # Define which entity to use
        target_entity: >
          {% if is_test_mode %}
            notify.telegram_bot_8053303995_15473309
          {% else %}
            notify.telegram_thuisapp
          {% endif %}
        # Clean message construction
        final_message: >
          {{ message_text }}
          {% if is_test_mode %}
          
          --- ðŸ›  DEBUG INFO ---
          Caller: {{ caller_id }}
          Labels: {{ labels_list | join(', ') }}
          {% endif %}
    
    # THE NEW MODERN ACTION
    - action: notify.send_message
      target:
        entity_id: "{{ target_entity }}"
      data:
        message: "{{ final_message }}"
